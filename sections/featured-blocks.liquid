

{% assign layout = section.settings.layout %}
{% assign IsMobile_carousel = section.settings.mobile_carousel %}
{% assign blocks_size = section.blocks.size %}

{% case blocks_size %}
{% when 1 %}
{% assign block_width = '' %}
{% when 2 %}
{% assign block_width = 'medium-up--one-half small--one-whole' %}
{% when 3 %}
{% assign block_width = 'medium-up--one-third small--one-whole' %}
{% when 4 %}
{% assign block_width = 'medium-up--one-quarter small--one-whole' %}
{% endcase %}

<style>
    @media screen and (min-width: 750px) { 
        #shopify-section-{{ section.id }}.opk_featured_products {
            padding-top: {{ section.settings.padding_top }}px;
            padding-bottom: {{ section.settings.padding_bottom }}px;
        }
    } 
    
    @media screen and (max-width: 749px) {
        #shopify-section-{{ section.id }}.opk_featured_products {
            padding-top: {{ section.settings.padding_top_mobile }}px;
            padding-bottom: {{ section.settings.padding_bottom_mobile }}px;
        }       
    } 
  	#shopify-section-{{ section.id }} .opk__subtitle {
      	color: {{ section.settings.subtitle_color }};
   	}

    #shopify-section-{{ section.id }} .opk__subtitle::before {
        background-color: {{ section.settings.subtitle_color }};
    }
</style>

<section id="section-{{ section.id }}" data-section-id="{{ section.id }}" data-section-type="featured-blocks" class='fade-in-animation'>  
    
    {% if section.settings.title != blank or  section.settings.subtitle != blank %}
      	<div class="homepage_subtitle_style_{{settings.homepage_subtitle_color}} opk_feature_row__heading page-width">
          {% if section.settings.subtitle != blank  %}
          <div class="opk__subtitle_wrap">
            <span class='opk__subtitle'>{{ section.settings.subtitle }}</span>
          </div> 
          {% endif %}
          {% if section.settings.title != blank  %}
            {% render 'opk-head-title', bg_mod: true, title: section.settings.title | escape %}
          {% endif %}
      	</div>
    {% endif %}
    
    
    {% if blocks_size > 0 %}
      <div class="opk_feature_row__container page-width">
      <div class='zoom-fade-animation opk_feature_row__wrap  featured-blocks-wrapper {% if IsMobile_carousel %} mobile_carousel {% endif %}' >
        {% for block in section.blocks %} 
            <div class='zoom-fade-animation-element-wrapper opk_feature_row__item {{block_width}} featured-block layout_{{layout}} image_style_{{section.settings.image_style}}' >
              {% assign image = block.settings.image %}
              {% assign link = block.settings.url %}
              {% assign heading = block.settings.heading %}
              {% assign content = block.settings.content %}
              
              
              <div class='featured-block-wrapper'>

              {% if link != blank %}
                <a href='{{link}}' class='featured-block_link' aria-label="{{heading}}"></a>
              {% endif %}           
                
                <div  class='featured-block-image-container'  {% if image == blank %} data-image-loading-animation {% endif %}>     
                
                  {% if image != blank %}

                  {% capture img_id %}Image-{{ image.id }}{% endcapture %}
                  {% capture img_wrapper_id %}ImageWrapper-{{ image.id }}{% endcapture %}

                  <img id="{{ img_id }}"  
                      class="featured-block-image zoom-fade-animation-element"
                      srcset="{%- if image.width >= 375 -%}{{ image | img_url: '375x' }} 375w,{%- endif -%}
                              {%- if image.width >= 720 -%}{{ image | img_url: '720x' }} 750w,{%- endif -%}
                              {%- if image.width >= 1066 -%}{{ image | img_url: '1066x' }} 1066w,{%- endif -%}
                              {%- if image.width >= 1500 -%}{{ image | img_url: '1500x' }} 1500w,{%- endif -%}
                              {%- if image.width >= 1780 and blocks_size < 4 -%}{{ image | img_url: '1780x' }} 1780w,{%- endif -%}
                              {%- if image.width >= 2000 and blocks_size < 3 -%}{{ image | img_url: '2000x' }} 2000w,{%- endif -%}
                              {%- if image.width >= 2800 and blocks_size < 2 -%}{{ image | img_url: '2800x' }} 2800w{%- endif -%}"
                      src="{{ image | img_url: '535x' }}"
                      sizes="(min-width: 750px) calc(100vw / {{ blocks_size }}), 100vw"
                      loading="lazy"
                      width="{{ image.width }}"
                      height="{{ image.height }}"
                      alt="{{image.alt | default: heading }}"
                      style="object-position:{{ image.presentation.focal_point }};">
                  
                  {% render 'load_spinner' %}
                  {% else %}
    
                  {% capture current %}{% cycle 1, 2, 3, 4, 5, 6 %}{% endcapture %}
                  {{ 'product-' | append: current | placeholder_svg_tag: 'placeholder-svg featured-block-image zoom-fade-animation-element' }}
                  
                  {% endif %}
                </div>
              
                {% if heading != blank or content != blank %}
                <div class='featured-block-content-wrapper'>
                  <div class='featured-block-content'>
                    {% if heading != blank %}
                    <span class='h4'>{{heading}}</span>
                    {% endif %}
                    {% if content != blank %}
                    <div> {{content}} </div>
                    {% endif %}
                  </div>
                </div>
                {% endif %}
              </div>              
            </div>
        {% endfor %}
      </div>
      </div>
      
    {% endif %}
 
</section>


{% schema %}
  {
    "name": "t:sections.featured-blocks.name",
    "class": "index-section opk_feature_row",
    "max_blocks":4,
    "settings": [
      {
            "type": "range",
            "id": "padding_top",
            "min": 20,
            "max": 200,
            "step": 5,
            "unit": "px",
            "label": "Padding top", 
            "default": 90       
        },
        {
            "type": "range",
            "id": "padding_bottom",
            "min": 20,
            "max": 200,
            "step": 5,
            "unit": "px",
            "label": "Padding bottom",
            "default": 90              
        },
        {
            "type": "range",
            "id": "padding_top_mobile",
            "min": 0,
            "max": 100,
            "step": 5,
            "unit": "px",
            "label": "Padding top mobile", 
            "default": 40       
        },
        {
            "type": "range",
            "id": "padding_bottom_mobile",
            "min": 0,
            "max": 100,
            "step": 5,
            "unit": "px",
            "label": "Padding bottom mobile",
            "default": 40              
        },            
      {
        "type": "select",
        "id": "layout",
        "label": "t:sections.featured-blocks.settings.layout.label",
        "options": [
          {
                "value": "mosaic",
                "label": "t:sections.featured-blocks.settings.layout.options__1.label"
          },
          {
                "value": "grid",
                "label": "t:sections.featured-blocks.settings.layout.options__2.label"
          }
              ],
        "default":"grid"
      },
    {
      "type": "text",
      "id": "title",
      "label": "t:sections.featured-blocks.settings.title.label",
		  "default":"Heading"
    },
		{
      "type":"text",
      "id":"subtitle",
      "label":"t:sections.featured-blocks.settings.subtitle.label",
      "default":"Subheading"
    },
    {
      "type": "color",
      "id": "subtitle_color",
      "label": "Color for subtitle",
      "default": "#FB5F1B"
    },
    {
      "type": "select",
      "id": "image_style",
      "label": "t:sections.featured-blocks.settings.image_style.label",
	    "options": [
		{
          "value": "circle",
          "label": "t:sections.featured-blocks.settings.image_style.options__1.label"
		},
		{
          "value": "square",
          "label": "t:sections.featured-blocks.settings.image_style.options__2.label"
		},
		{
          "value": "background",
          "label": "t:sections.featured-blocks.settings.image_style.options__3.label"
		}
	],
	"default":"circle"
	},
		{
	"type":"checkbox",
	"id":"mobile_carousel",
	"label":"t:sections.featured-blocks.settings.mobile_carousel.label"
	}
	],
	"blocks": [
		{
	"name":"t:sections.featured-blocks.blocks.block.name",
	"type":"block",
	"settings": [
	{
	"type":"text",
	"id":"heading",
	"label":"t:sections.featured-blocks.blocks.block.settings.heading.label",
	"default":"Block title"
	},
	{
	"type":"richtext",
	"id":"content",
	"label":"t:sections.featured-blocks.blocks.block.settings.content.label",
	"default":"<p>Default text</p>"
	},
	{
	"type":"image_picker",
	"id":"image",
	"label":"t:sections.featured-blocks.blocks.block.settings.image.label"
	},
	{
	"type":"url",
	"id":"url",
	"label":"t:sections.featured-blocks.blocks.block.settings.url.label"
	}
]
}
	],
	"presets": [
	{
	"name": "t:sections.featured-blocks.presets.name",
	"category":"Custom Sections",
	"blocks": [
	{
		"type":"block"
	},
	{
		"type":"block"
	},
	{
		"type":"block"
	},
	{
		"type":"block"
	}
		]
	}
	]
  }
{% endschema %}
